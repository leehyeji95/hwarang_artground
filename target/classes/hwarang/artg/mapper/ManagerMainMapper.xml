<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="hwarang.artg.mapper.ManagerMainMapper">
<select id="getMembersCount" resultType="int">
	SELECT count(*) FROM MEMBER 
</select>
<select id="getNewMemberCount" resultType="int">
	<![CDATA[
		SELECT count(*) FROM MEMBER 
		 WHERE MEMBER_REG_DATE >= TO_CHAR(sysdate-7, 'YYYY-MM-DD')
	]]>
</select>
<select id="getNewMember" resultType="hwarang.artg.member.model.MemberVO">
	<![CDATA[
		SELECT * FROM MEMBER 
		 WHERE MEMBER_REG_DATE >= TO_CHAR(sysdate-7, 'YYYY-MM-DD')
		 ORDER BY MEMBER_REG_DATE
	]]>
</select>
<select id="getTotalPost" resultType="int">
	<![CDATA[
		SELECT SUM(num_rows) FROM user_tables WHERE table_name LIKE '%BOARD%'
	]]>
</select>
<select id="getTotalReply" resultType="int">
	<![CDATA[
		SELECT SUM(num_rows) FROM user_tables WHERE table_name LIKE '%REPLY%'
	]]>
</select>
<select id="todayGetQnACount" resultType="int">
	<![CDATA[
		SELECT count(*) FROM QNA WHERE TO_CHAR(QNA_REG_DATE, 'YYYY-MM-DD') = TO_CHAR(sysdate, 'YYYY-MM-DD')
	]]>
</select>
<select id="todayGetReportBCount" resultType="int">
	<![CDATA[
		SELECT count(*) FROM REPORT_BOARD WHERE TO_CHAR(REPORT_REG_DATE, 'YYYY-MM-DD') = TO_CHAR(sysdate, 'YYYY-MM-DD')
	]]>
</select>
<select id="todayGetBBCount" resultType="int">
	<![CDATA[
		SELECT count(*) FROM BLOCK_STATUS WHERE TO_CHAR(B_REG_DATE, 'YYYY-MM-DD') = TO_CHAR(sysdate, 'YYYY-MM-DD')
	]]>
</select>
<select id="todayGetReviewBCount" resultType="int">
	<![CDATA[
		SELECT count(*) FROM REVIEW_BOARD WHERE TO_CHAR(REVIEW_REG_DATE, 'YYYY-MM-DD') = TO_CHAR(sysdate, 'YYYY-MM-DD')
	]]>
</select>
<select id="todayGetFBCount" resultType="int">
	<![CDATA[
		SELECT count(*) FROM FREE_BOARD WHERE TO_CHAR(FREE_REGDATE, 'YYYY-MM-DD') = TO_CHAR(sysdate, 'YYYY-MM-DD')
	]]>
</select>
<select id="todayGetRecommBCount" resultType="int">
	<![CDATA[
		SELECT count(*) FROM RECOMMEND_BOARD WHERE TO_CHAR(RECOMM_REG_DATE, 'YYYY-MM-DD') = TO_CHAR(sysdate, 'YYYY-MM-DD')
	]]>
</select>
<select id="getExhibCountMonth" resultType="int">
	<![CDATA[
		select count(*) from exhibition where trunc(exh_startdate, 'mm') = trunc(sysdate, 'mm')
	]]>
</select>
<select id="getTotalPrice" resultType="int">
	select sum(funding_price) from crowdfunding
</select>
<select id="getReviews"
		resultType="hwarang.artg.rrboard.model.ReviewBoardVO">
		select *
		from ( select * from review_board order by review_reg_date desc)
		where rownum between 1 and 5
	</select>

<sql id="criteriaDTO">
	<trim prefix="(" suffix=") AND " prefixOverrides="OR">
		<foreach collection="typeArr" item="type">
			<trim prefix="OR">
				<choose>
					<when test="type == 'W'.toString()">
						<![CDATA[
							MEMBER_REG_DATE >= TO_CHAR(sysdate-7, 'YYYY-MM-DD')
						]]>
					</when>
					<when test="type == 'M'.toString()">
						<![CDATA[
							MEMBER_REG_DATE >= ADD_MONTHS(sysdate, -1)
						]]>
					</when>
					<when test="type == 'Y'.toString()">
						<![CDATA[
							MEMBER_REG_DATE >= ADD_MONTHS(sysdate, -12)
						]]>
					</when>
					<when test="type == 'I'.toString()">
							MEMBER_ID like '%'||#{keyword}||'%'
					</when>
				</choose>
			</trim>
		</foreach>
	</trim>
</sql>
<!-- MemberList 페이징 -->
<select id="getTotalMemCount" resultType="int">
	SELECT count(*) FROM MEMBER
		WHERE
		<include refid="criteriaDTO"></include>
		1 > 0
</select>
<select id="getListWithPaging" resultType="hwarang.artg.member.model.MemberVO">
	<![CDATA[
 			SELECT MEMBER_ID, MEMBER_NAME, MEMBER_PASSWORD, MEMBER_EMAIL, MEMBER_GENDER, MEMBER_PHONENUM, MEMBER_ADDRESS, MEMBER_REG_DATE, MEMBER_REPORT_COUNT, MEMBER_STATUS, MEMBER_POINT
 			  FROM (SELECT /*+INDEX_DESC(MEMBER MEM_REG_DATE) */ rownum as rNum, MEMBER_ID, MEMBER_NAME, MEMBER_PASSWORD, MEMBER_EMAIL, MEMBER_GENDER, MEMBER_PHONENUM, MEMBER_ADDRESS, MEMBER_REG_DATE, MEMBER_REPORT_COUNT, MEMBER_STATUS, MEMBER_POINT
 					  FROM MEMBER 
 					 WHERE 
 		]]>
 			<include refid="criteriaDTO"></include>
 		<![CDATA[ 
 			 rownum <= #{pageNum} * #{amount} AND MEMBER_REG_DATE >= '1900/01/01')
 			 WHERE rNum > (#{pageNum} - 1) * #{amount}
 		]]>
</select>
</mapper>